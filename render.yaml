services:
  # ─── Python AI Sinyal Servisi ────────────────────────────────────────────────
  - type: web
    name: cortexa-ai
    runtime: python
    plan: free
    buildCommand: pip install -r ai-service/requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: BINANCE_BASE_URL
        value: https://api.binance.com
      - key: BINANCE_FALLBACK_URL
        value: https://data-api.binance.vision
      - key: FRONTEND_ORIGIN
        sync: false  # Render dashboard'dan girin

  # ─── Go Backend API ──────────────────────────────────────────────────────────
  - type: web
    name: cortexa-api
    runtime: docker
    plan: free
    dockerfilePath: ./Dockerfile
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: cortexa-db
          property: connectionString
      - key: AI_SERVICE_URL
        sync: false  # cortexa-ai URL'ini girin: https://cortexa-ai.onrender.com/predict
      - key: JWT_SECRET
        generateValue: true
      - key: OWNER_EMAIL
        sync: false
      - key: PREMIUM_DISABLED
        value: "true"

  # ─── Frontend (statik site) ──────────────────────────────────────────────────
  - type: web
    name: cortexa-frontend
    runtime: static
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: ./frontend/dist
    envVars:
      - key: VITE_API_URL
        sync: false  # cortexa-api URL'ini girin: https://cortexa-api.onrender.com

databases:
  - name: cortexa-db
    plan: free
    databaseName: cta
